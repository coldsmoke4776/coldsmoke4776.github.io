---
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/Section.astro";
import { ARCADE_EXPERIENCES } from "@/data/arcade";

const intro =
  "Arcade is where I drop the playable bits—math sims, browser-friendly games, and UI toys that are meant to be touched, not just read about.";
---

<Layout title="Arcade — Matt Twells">
  <Section title="Arcade">
    <div class="max-w-5xl mx-auto space-y-6 text-center">
      <p class="text-lg md:text-xl text-white/70 leading-relaxed">{intro}</p>
      <p class="text-sm text-white/50">
        Everything below either already runs in your browser or is in the queue for a live build. Hit a link, spawn the demo, and let the systems ride.
      </p>
    </div>
    <div class="mx-auto mt-10 grid max-w-6xl gap-6 md:grid-cols-2">
      {
        ARCADE_EXPERIENCES.map((experience) => (
          <article
            id={experience.title === "C&D&D Terminal RPG" ? "cndnd-terminal" : undefined}
            class="flex flex-col gap-4 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-[0_20px_60px_-40px_rgba(0,0,0,0.8)]"
          >
            <div class="flex items-center gap-3">
              <h3 class="text-2xl font-semibold text-[#0f0]">{experience.title}</h3>
            </div>
            <p class="text-base text-white/80 leading-relaxed">{experience.description}</p>
            <div class="flex flex-wrap gap-2">
              {
                experience.tags.map((tag) => (
                  <span class="text-xs font-mono tracking-[0.3em] uppercase text-white/60 bg-white/5 px-3 py-1 rounded-full border border-white/10">
                    {tag}
                  </span>
                ))
              }
            </div>
            <div class="flex flex-wrap gap-2">
              {
                experience.links.map((link) => {
                  const isExternal = !link.href.startsWith("/");
                  return (
                    <a
                      class="text-sm font-semibold uppercase tracking-[0.3em] text-white bg-black/70 border border-white/30 px-4 py-2 rounded-full hover:bg-white hover:text-black transition"
                      href={link.href}
                      target={isExternal ? "_blank" : undefined}
                      rel={isExternal ? "noreferrer" : undefined}
                    >
                      {link.label}
                    </a>
                  );
                })
              }
            </div>
            {
              experience.terminalDemo && (
                <div class="mt-4">
                  <p class="text-xs uppercase tracking-[0.4em] text-white/50">
                    {experience.terminalDemo.caption}
                  </p>
                  <div
                    data-terminal-demo={JSON.stringify(experience.terminalDemo.frames)}
                    class="arcade-terminal mt-2"
                    aria-live="polite"
                  >
                    <pre class="terminal-output"></pre>
                    <span class="cursor" aria-hidden="true"></span>
                  </div>
                </div>
              )
            }
          </article>
        ))
      }
    </div>
  </Section>
  <script is:inline>
    if (typeof window !== "undefined") {
      const typeConfig = { typingSpeed: 30, shortPause: 800, resetPause: 1800 };

      const playTerminal = (outputEl, frames) => {
        let frameIndex = 0;
        let charIndex = 0;
        let accumulated = "";

        const step = () => {
          const frame = frames[frameIndex] || "";
          if (charIndex <= frame.length) {
            outputEl.textContent = accumulated + frame.slice(0, charIndex);
            charIndex += 1;
            setTimeout(step, typeConfig.typingSpeed);
          } else {
            accumulated += frame + "\n";
            frameIndex += 1;
            charIndex = 0;
            const pause = frameIndex >= frames.length ? typeConfig.resetPause : typeConfig.shortPause;
            if (frameIndex >= frames.length) {
              frameIndex = 0;
              accumulated = "";
            }
            setTimeout(step, pause);
          }
        };

        step();
      };

      const terminals = document.querySelectorAll("[data-terminal-demo]");
      terminals.forEach((terminal) => {
        try {
          const frames = JSON.parse(terminal.getAttribute("data-terminal-demo"));
          const output = terminal.querySelector(".terminal-output");
          if (Array.isArray(frames) && output) {
            playTerminal(output, frames);
          }
        } catch (error) {
          console.error("Could not parse terminal demo frames", error);
        }
      });
    }
  </script>
</Layout>
